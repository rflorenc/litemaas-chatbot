# OpenShift-specific values override file
# Use this with: helm install -f values.yaml -f values-openshift.yaml

# Image configuration for OpenShift
image:
  # Use OpenShift-built image from internal registry
  # This is built on the correct architecture (x86_64)
  repository: image-registry.openshift-image-registry.svc:5000/mentor-bot-rlteam/mentor-bot
  pullPolicy: Always
  tag: "latest"

# Service account - OpenShift requires specific SCC
serviceAccount:
  create: true
  name: "mentor-bot-sa"
  annotations:
    description: "Service account for Open Source Mentor Bot"

# Pod security context for OpenShift
podSecurityContext:
  # OpenShift assigns UID/GID automatically from project range
  # Do NOT set runAsUser or fsGroup - OpenShift will assign from project range
  runAsNonRoot: true
  # runAsUser: NOT SET - OpenShift assigns automatically
  # fsGroup: NOT SET - OpenShift assigns automatically
  seccompProfile:
    type: RuntimeDefault

# Container security context for OpenShift restricted-v2 SCC
securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
    - ALL
  # OpenShift needs writable temp directories
  readOnlyRootFilesystem: false
  # Let OpenShift SCC assign runAsUser
  runAsNonRoot: true

# Route configuration - OpenShift native
route:
  enabled: true
  # Auto-generate hostname based on namespace and cluster domain
  host: ""
  path: ""
  tls:
    termination: edge
    insecureEdgeTerminationPolicy: Redirect
  annotations:
    haproxy.router.openshift.io/timeout: "60s"
    # Optional: Rate limiting
    # haproxy.router.openshift.io/rate-limit-connections: "100"

# Disable standard Kubernetes ingress
ingress:
  enabled: false

# OpenShift-specific pod annotations
podAnnotations:
  prometheus.io/scrape: "true"
  prometheus.io/port: "8080"
  prometheus.io/path: "/metrics"
  # OpenShift monitoring
  openshift.io/scc: "restricted-v2"

# Resource limits tuned for OpenShift
resources:
  limits:
    cpu: 1000m
    memory: 512Mi
  requests:
    cpu: 100m
    memory: 128Mi

# Autoscaling enabled for OpenShift
autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 3
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80

# Health probes adjusted for OpenShift
livenessProbe:
  httpGet:
    path: /health
    port: http
    scheme: HTTP
  initialDelaySeconds: 30
  periodSeconds: 20
  timeoutSeconds: 5
  successThreshold: 1
  failureThreshold: 3

readinessProbe:
  httpGet:
    path: /health
    port: http
    scheme: HTTP
  initialDelaySeconds: 15
  periodSeconds: 10
  timeoutSeconds: 5
  successThreshold: 1
  failureThreshold: 3

startupProbe:
  httpGet:
    path: /health
    port: http
    scheme: HTTP
  initialDelaySeconds: 10
  periodSeconds: 5
  timeoutSeconds: 3
  successThreshold: 1
  failureThreshold: 12

# OpenShift labels
labels:
  app: mentor-bot
  team: rlteam
  version: v1
  app.kubernetes.io/part-of: mentor-bot
  app.openshift.io/runtime: python
  app.openshift.io/runtime-version: "3.11"

# Node selector for OpenShift nodes
nodeSelector: {}
  # Optional: Run on specific OpenShift node pools
  # node-role.kubernetes.io/worker: ""

# Tolerations for OpenShift taints
tolerations: []
  # Optional: Tolerate specific OpenShift taints
  # - key: "node.kubernetes.io/not-ready"
  #   operator: "Exists"
  #   effect: "NoExecute"
  #   tolerationSeconds: 300

# Affinity rules for OpenShift
affinity: {}
  # Optional: Pod anti-affinity for high availability
  # podAntiAffinity:
  #   preferredDuringSchedulingIgnoredDuringExecution:
  #   - weight: 100
  #     podAffinityTerm:
  #       labelSelector:
  #         matchExpressions:
  #         - key: app
  #           operator: In
  #           values:
  #           - mentor-bot
  #       topologyKey: kubernetes.io/hostname
